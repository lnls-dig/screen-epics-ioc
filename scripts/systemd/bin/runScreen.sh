#!/usr/bin/env bash

set -u

if [ -z "$SCREEN_INSTANCE" ]; then
    echo "SCREEN_INSTANCE environment variable is not set." >&2
    exit 1
fi

export SCREEN_CURRENT_PV_AREA_PREFIX=SCREEN_${SCREEN_INSTANCE}_PV_AREA_PREFIX
export SCREEN_CURRENT_PV_DEVICE_PREFIX=SCREEN_${SCREEN_INSTANCE}_PV_DEVICE_PREFIX
export SCREEN_CURRENT_MTR_CTRL_PREFIX=SCREEN_${SCREEN_INSTANCE}_MTR_CTRL_PREFIX
export SCREEN_CURRENT_CAM_PREFIX=SCREEN_${SCREEN_INSTANCE}_CAM_PREFIX
export SCREEN_CURRENT_DEVICE_TELNET_PORT_SUFFIX=SCREEN_${SCREEN_INSTANCE}_TELNET_PORT_SUFFIX
# Only works with bash
export SCREEN_PV_AREA_PREFIX=${!SCREEN_CURRENT_PV_AREA_PREFIX}
export SCREEN_PV_DEVICE_PREFIX=${!SCREEN_CURRENT_PV_DEVICE_PREFIX}
export SCREEN_MTR_CTRL_PREFIX=${!SCREEN_CURRENT_MTR_CTRL_PREFIX}
export SCREEN_CAM_PREFIX=${!SCREEN_CURRENT_CAM_PREFIX}
export SCREEN_DEVICE_TELNET_PORT=${PROCSERV_SCREEN_PORT_PREFIX}${!SCREEN_CURRENT_DEVICE_TELNET_PORT_SUFFIX}

if [ -z "${SCREEN_CURRENT_DEVICE_TELNET_PORT_SUFFIX}" ]; then
    echo "TELNET port is not set." >&2
    exit 1
fi

./runProcServ.sh \
    -m "${SCREEN_MTR_CTRL_PREFIX}" \
    -c "${SCREEN_CAM_PREFIX}" \
    -P "${SCREEN_PV_AREA_PREFIX}" \
    -R "${SCREEN_PV_DEVICE_PREFIX}" \

